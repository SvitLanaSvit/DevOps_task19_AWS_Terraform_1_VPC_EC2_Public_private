# üì¶ S3 Backend –¥–ª—è Terraform State

## –ß–æ–º—É –≤–∞–∂–ª–∏–≤–∏–π S3 Backend?

### –ü—Ä–æ–±–ª–µ–º–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ tfstate:
- üö´ –§–∞–π–ª –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –Ω–∞ –≤–∞—à–æ–º—É –∫–æ–º–ø'—é—Ç–µ—Ä—ñ
- üö´ –ù–µ–º–æ–∂–ª–∏–≤–∞ –∫–æ–º–∞–Ω–¥–Ω–∞ —Ä–æ–±–æ—Ç–∞
- üö´ –†–∏–∑–∏–∫ –≤—Ç—Ä–∞—Ç–∏ –ø—Ä–∏ –ø–æ–ª–æ–º—Ü—ñ –¥–∏—Å–∫–∞
- üö´ –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –≤–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –±–µ–∫–∞–ø—ñ–≤

### –ü–µ—Ä–µ–≤–∞–≥–∏ S3 Backend:
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è state
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è  
- ‚úÖ –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- ‚úÖ –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è state (—á–µ—Ä–µ–∑ DynamoDB)
- ‚úÖ –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∫–æ–º–∞–Ω–¥–Ω–æ—ó —Ä–æ–±–æ—Ç–∏

### 1. S3 Bucket (`terraform-state-svitlana-vpc`)
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è tfstate —Ñ–∞–π–ª—É
- –í–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è —É–≤—ñ–º–∫–Ω–µ–Ω–æ
- –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è AES256
- –ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ –ø—É–±–ª—ñ—á–Ω–∏–π –¥–æ—Å—Ç—É–ø
- –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è

### 2. DynamoDB —Ç–∞–±–ª–∏—Ü—è (`terraform-state-locks`)
- –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è state –ø—ñ–¥ —á–∞—Å –æ–ø–µ—Ä–∞—Ü—ñ–π
- –ó–∞–ø–æ–±—ñ–≥–∞—î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∞–º –ø—Ä–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ–π —Ä–æ–±–æ—Ç—ñ
- Billing mode: PAY_PER_REQUEST (–ø–ª–∞—Ç–∏—Ç–µ —Ç—ñ–ª—å–∫–∏ –∑–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è)

## –ü–æ—Ä—è–¥–æ–∫ —Ä–æ–±–æ—Ç–∏:

### –ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è backend —Ä–µ—Å—É—Ä—Å—ñ–≤
```bash
# –°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—é—î–º–æ S3 —Ç–∞ DynamoDB –ë–ï–ó backend –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
# –¢–∏–º—á–∞—Å–æ–≤–æ –∑–∞–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ —Å–µ–∫—Ü—ñ—é backend –≤ main.tf

terraform init
terraform plan
terraform apply
```

### –ö—Ä–æ–∫ 2: –ú—ñ–≥—Ä–∞—Ü—ñ—è –Ω–∞ S3 backend
```bash
# –†–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ backend —Å–µ–∫—Ü—ñ—é –≤ main.tf
terraform init
# Terraform –∑–∞–ø—Ä–æ–ø–æ–Ω—É—î –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —ñ—Å–Ω—É—é—á–∏–π state –≤ S3
# –í—ñ–¥–ø–æ–≤—ñ–¥—å—Ç–µ "yes"
```

### –ö—Ä–æ–∫ 3: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ state —Ç–µ–ø–µ—Ä –≤ S3
aws s3 ls s3://terraform-state-svitlana-vpc/terraform/
```

## –ë–µ–∑–ø–µ–∫–∞:

‚ö†Ô∏è **–í–ê–ñ–õ–ò–í–û**:
- –ù—ñ–∫–æ–ª–∏ –Ω–µ –∫–æ–º–º—ñ—Ç—å—Ç–µ tfstate —Ñ–∞–π–ª–∏ –≤ git
- S3 bucket –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∏–º
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ IAM –ø—Ä–∞–≤–∞ –¥–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É
- –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ–±—ñ—Ç—å –±–µ–∫–∞–ø–∏

## Troubleshooting:

### –ü–æ–º–∏–ª–∫–∞ "bucket doesn't exist":
```bash
# –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ bucket —Å—Ç–≤–æ—Ä–µ–Ω–∏–π
aws s3 ls | grep terraform-state

# –°—Ç–≤–æ—Ä—ñ—Ç—å bucket —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
aws s3 mb s3://terraform-state-svitlana-vpc --region eu-central-1
```

### –ü–æ–º–∏–ª–∫–∞ "DynamoDB table doesn't exist":
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–∞–±–ª–∏—Ü—é
aws dynamodb list-tables --region eu-central-1
```

---

**–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫**: –ü—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è backend —Å—Ç–≤–æ—Ä—é—î–º–æ VPC —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É.